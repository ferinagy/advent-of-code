package com.github.ferinagy.adventOfCode.aoc2017

import com.github.ferinagy.adventOfCode.Coord2D
import com.github.ferinagy.adventOfCode.toCharGrid
import com.github.ferinagy.adventOfCode.contains
import com.github.ferinagy.adventOfCode.get

fun main() {
    println("Part 1 and 2:")
    println(part1and2(testInput1))
    println(part1and2(input))
}

private fun part1and2(input: String): Int {
    val grid = input.lines().toCharGrid()
    val x = grid.xRange.indexOfFirst { grid[it, 0] != ' ' }
    var position = Coord2D(x, 0)
    var direction = Coord2D(0, 1)
    var visited = ""
    var steps = 0

    val directions = setOf(Coord2D(0, 1), Coord2D(0, -1), Coord2D(1, 0), Coord2D(-1, 0))
    while (true) {
        position += direction
        steps++

        if (position !in grid || grid[position] == ' ') break

        if (grid[position].isLetter()) visited += grid[position]

        if (grid[position] == '+') {
            val turns = directions - direction - (direction.copy(x = -1 * direction.x, y = -1 * direction.y))
            val nextDir = turns.single {
                val next = position + it
                if (next !in grid) false else grid[next] != ' '
            }

            direction = nextDir
        }
    }

    println(visited)

    return steps
}

private const val testInput1 = """     |          
     |  +--+    
     A  |  C    
 F---|----E|--+ 
     |  |  |  D 
     +B-+  +--+ """

private const val input = """                                                                                                                                                   |                                                     
                         +-+             +-----------------------------+   +---+                                                           +-------+   +-+ +-+                   +-+     +-------+   +-+ 
                         | |             |                             |   |   |                                                           |           | | | |                   | |     |       |   | | 
           +-------------+ |   +-+     +-------------------------------|---|---|---------------------------------------------------------+ |           | | | |                   | |     |     +-+   | | 
           |               |   | |     | |                             |   |   |                                                         | |           | | | |                   | |     |     |     | | 
           |               |   | |     | |                 +-+   +---+ |   |   |         +-------------------------------------------------|-------------+ | |                   | |     |     |     | | 
           |               |   | |     | |                 | |   |   | |   |   |         |                                               | |           |   | |                   | |     |     |     | | 
   +-------|-------------------|-|-+   | |             +---+ I +-|---|-|---+   |         |                   +-------------------------------------------------------------------|-|-----|---+ +-------+ 
   |       |               |   | | |   | |             |       | |   | |       |         |                   |                           | |           |   | |                   | |     |   |       |   
   |       |               |   +---------|-------------|---------+ +-|---------|---------|-----------+       |                           | |     +---------|-|-------------------------------|-----+ |   
   |       |               |     | |   | |             |       |   | | |       |         |           |       |                           | |     |     |   | |                   | |     |   |     | |   
   |       |               |     | | +---|-------------|-------|---|-|-------------+     |           |       |                     +-------|-+   |     |   | +---------------------|-----|---+     | |   
   |       |               |     | | | | |             |       |   | | |       |   |     |           |       |                     |     | | |   |     |   |                     | |     |         | |   
   |       |               |     | | | | |             |       |   | | |   +---|---------|-----------|-------|---------------------|-------|-----------|-------------------------|-------|-------+ | |   
   |       |               |     | | | | |             |       |   | | |   |   |   |     |           |       |                     |     | | |   |     |   |                     | |     |       | | |   
   |       |               |     | | | | |             | +-----|---|-------|-------|-----|-----------------------------------------|---------|-------+ |   +---------------------|-|-------------|---+   
   |       |               |     | | | | |             | |     |   | | |   |   |   |     |           |       |                     |     | | |   |   | |                         | |     |       | |     
   |       |               |     | +-|-|---------------|-|-----|-----|-|---+   |   |     |           |       |                     |     | | |   |   | |       +-------------+   +-------|---+   | |     
   |       |               |     |   | | |             | |     |   | | |       |   |     |           |       |                     |     | | |   |   | |       |             |     |     |   |   | |     
 +---------------------+ +-------|-----|---------------|-|-----|-----|-|-----------+     |           |       |           +-----------------|-----|-----|---------------------------|-----|-----+ | |     
 | |       |           | | |     |   | | |             | |     |   | | |       |         |           |       |           |         |     | | |   |   | |       |             |     |     |   | | | |     
 | |       |           | | |     |   | | |             | |     | +-|---|-------|---------------------|-------------------|---------|-----|-------|---|-|-------|-----------------------+ |   | | | |     
 | |       |           | | |     |   | | |             | |     | | | | |       |         |           |       |           |         |     | | |   |   | |       |             |     |   | |   | | | |     
 | |       |           | | |     |   | | |         +-----|---+ +-------|-----------------|-----------|-------+           |         | +---|-------------|---------------------|---------|-|-----+ | |     
 | |       |           | | |     |   | | |         |   | |   |   | | | |       |         |           |                   |         | |   | | |   |   | |       |             |     |   | |   |   | |     
 | | +-+ +-|-----------|-------------|-|-|---------------------+ | | +-|-----------------|-----------|---+     +---------|---------------|-|-|-----------------|-------------|-----|-----|---|---------+ 
 | | | | | |           | | |     |   | | |         |   | |   | | | |   |       |         |           |   |     |         |         | |   | | |   |   | |       |             |     |   | |   |   | |   | 
 | | | | | |           | | |     |   | | |         | +-|-|-+ | | | |   |       |         |           |   | +---|-----+   |         | |   | | |   |   | |       |       +-----|-----|-----|---+   | |   | 
 | | | | | |           | | |     |   | | |         | | | | | | | | |   |       |         |           |   | |   |     |   |         | |   | | |   |   | |       |       |     |     |   | |       | |   | 
 | | | | | +---+       | | |     |   | | |         +-|---|---|-|-----+ |   +-------------|-----------|---+ |   |     |   |         | |   | | |   |   | |       | +-----------------------|-+     | |   | 
 | | | | |     |       | | |     |   | | |           | | | | | | | | | |   |   |         |           |     |   |     |   |         | |   | | |   |   | |       | |     |     |     |   | | |     | |   | 
 | | | | |     |       | | |     |   | | |           | | | | | | | | | |   |   |         |   +---------------------------------------|---|---|---|---------------------|-------------------+     | |   | 
 | | | | |     |       | | |     |   | | |           | | | | | | | | | |   |   |         |   |       |     |   |     |   |         | |   | | |   |   | |       | |     |     |     |   | |       | |   | 
 | | | | |     |       | | |     |   | | |           | | | | | | | | | |   |   |         |   |       +-----|-+ |   +-----|-----------|---|-|-|-------------+ +---|-+   |     |     | +-----+     | |   | 
 | | | | |     |       | | |     |   | | |           | | | | | | | | | |   |   |         |   |             | | |   | |   |         | |   | | |   |   | |   | | | | |   |     |     | | | | |     | |   | 
 | | | | |     |       | | |     |   | | |           | | +-|-|-|---+ | |   |   |         |   |             | | |   | +-------------|-----------------|-|---|-|-|---|---------------|-|-|-|-----+ | |   | 
 | | | | |     |       | | |     |   | | |           | |   | | | |   | |   |   |         |   |             | | |   |     |         | |   | | |   |   | |   | | | | |   |     |     | | | | |   | | |   | 
 | | | | |     +---------|-|-----|-+ | | |           | |   | | | |   +-------------------|----------------------C--|---------------+ |   | | |   |   | |   | | +-------|-----|-----+ | | | |   | | |   | 
 | | | | |             | | |     | | | | |           | |   | | | |     |   |   |         |   |             | | |   |     |           |   | | |   |   | |   | |   | |   |     |       | | | |   | | |   | 
 | | | +-----------------|-------|-|---|-|-----------|-----|-|-|-|-----|-----------------|---|---------------------|-----|-----------|-------|-------|-----------|-----------|-----+ | | | | +-|-+ |   | 
 | | |   |             | | |     | | | | |           | |   | | | |     |   |   |         |   |             | | |   |     |           |   | | |   |   | |   | |   | |   |     |     | | | | | | |   |   | 
 | | |   |             | | |     | | | | |           | |   | | | |     |   |   |         |   |             | | |   |     |           |   | | |   |   | |   | |   | |   |     |     | +-|---|-+ |   |   | 
 | | |   |             | | |     | | | | |           | |   | | | |     |   |   |         |   |             | | |   |     |           |   | | |   |   | |   | |   | |   |     |     |   | | |   |   |   | 
 | | |   |             | | |     | | | +---------------------|---|---------|---------+   |   |             | | +---+     |           |   | | |   |   | |   | |   +-|-----------------+ | | | +-------+ | 
 | | |   |             | | |     | | |   |           | |   | | | |     |   |   |     |   |   |             | |           |           |   | | |   |   | |   | |     |   |     |     | | | | | | |   | | | 
 | | |   |             | | |     | | |   |           | |   | | | |     |   |   |     |   |   |             | |           |           |   | | |   |   | |   | |   +-|---------|-----|-|---+ | | |   | | | 
 | | |   |             | | |     | | |   |           | |   | | | |     |   |   |     |   |   |             | |           |           |   | | |   |   | |   | |   | |   |     |     | | |   | | |   | | | 
 | | |   |             | | |     | | |   |           | |   | | | | +---|---|-+ |     |   | +---+           | |           |           |   | | |   +-----|-----|---|-|-----------------|-----|---+   | | | 
 | | |   |             | | |     | | |   |           | |   | | | | |   |   | | |     |   | | | |           | |           |           |   | | |       | |   | |   | |   |     |     | | |   | |     | | | 
 | | |   |             | | |     | | |   |           +-|---|-------+   |   | | |     |   | | | |           | |           |           |   | | |       | |   | |   | |   |     |   +-|-|---------+   | | | 
 | | |   |             | | |     | | |   |             |   | | | |     |   | | |     |   | | | |           | |           |           |   | | |       | |   | |   | |   |     |   | | | |   | | |   | | | 
 | | |   |           +-|-----+   | | |   |             |   | | | |     |   | | |     |   | | | |           | |           |           |   | | |       | |   | +---|-|---|-----|---|-|-+ |   | | |   | | | 
 | | |   |           | | | | |   | | |   |             |   | | | |     |   | | |     |   | | | |           | |           |           |   | | |       | |   |     | |   |     |   | |   |   | | |   | | | 
 | | |   |           | | | | |   | | |   |     +-----+ +---------|---+ |   | | |     |   | | | |           | |           |           |   | | |       | |   |   +-|---+ |   +-----|---+ |   | | |   | | | 
 | | |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |           |   | | |       | |   |   | | | | |   | |   | | | |   | | |   | | | 
 | | |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |           |   | | |       | |   |   | | | | |   | |   | | | |   | | +-+ | | | 
 | | |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |           |   | | |       | |   |   | | | | |   | |   | | | |   | |   | | | | 
 +-+ |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |           |   | | |       | +---------|-|---------------------------+ | | | | 
     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |           |   | | |       |     |   | | | | |   | |   | | | |   | | | | | | | 
     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     +-----------|-----------------------|---------------|-|-----|-----|-|-|-+ 
     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     |     |   | | |       |     |   | | | | |   | |   | | | |   | | | | | |   
     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     |     |   | | |       |     |   | | | | |   | |   | | | | +-|---|-|-+ |   
     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     |     |   | | |       |     |   | | | | |   | |   | | | | | | | | |   |   
     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |     +-----|-------------|-----|-----|-----|---------|---------|-|-|-|-------|-----|-+ | | | | | |   |   
     |   |           | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |     |     | |           |     |     |   | | |       |     |   | | | | |   | |   | |   | | | | | |   |   
     |   |         +-------|-----|---|---|-----|-----|-----------|---|-|---|-|-|-----|-----|---------------|-|-----------|-----|-----|-----|---------|-----|-----|-|-|-----|-|-----|---|-|-------+   |   
     |   |         | | | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |     |     | |           |     |     |   | | |       |     |   | | | | |   | |   | |   | | | | |     |   
     |   |         | +-|---|---------|---|-------------------|-|-|---|-|---|-|-----------------|-----------|-|-----------|-----|-----|---------------------|-----------|---------|-----|---|---------|-+ 
     |   |         |   | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |     |     | |           |     |     |   | | |       |     |   | | | | |   | |   | |   | | | | |     | | 
     |   |         +---|---------|---|---|-----------|-----------------|---|---|------L----|-|-------+     | |           |     |     |   | | |       |     |   | +-|-|-|---|-|---|-----|-|---+ | +---+ | 
     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     |     |   | | |       |     |   |   | | |   | |   | |   | | |   | |     | 
     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     |     |   | | | +---------------------|-|-----|-----------|-------|---+ | 
     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | | |           | |           |     |     |   | | | |     |     |   |   | | |   | |   | |   | | |   | |   | | 
     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | | +-|-----------|-|---+       | +-------------|-----------------|---|-----|-|---|-|-----|---|-|---+ | |   | | 
     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | |   |           | |   |       | |   |     |   | | | |     |     |   |   | | |   | |   | |   | | | | | |   | | 
     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | |   +-------------|---|-------|-----|---------|---|-|-----|-----------+ | | | +-|-------|-------|-----|---+ | 
     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | |               | |   |       | |   |     |   | | | |     |     |   | | | | | | | |   | |   | | | | | |     | 
     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | |               | |   |       | |   |   +-------|-|-------------|---|-+ | | | | | |   | |   | | | | | |     | 
     |   |             | | | |   | | |   |     |     |     | | | |   | |   | | |     |   | |               | |   |       | |   |   | |   | | | |     |     |   |   | | | X | |   | |   | | | | | |     | 
     |   |             | | | +---|-------|-----------------|---|-|-------------------|---------+           +-----|-------------|-----|-----|-----------------------|-|-------|---|-|---|-|-|-|-------+ | 
     |   |             | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |             |   |       | |   |   | |   | | | |     |     |   |   | | | | | |   | |   | | | | | |   | | 
   +--B--|---------+   | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |           +-|-----------|---+ |   | |   | | | |     |     |   | +-|---|---------+ |   | | | | | |   | | 
   | |   |         |   | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |           | |   |       | | | |   | |   | | | |     |     |   | | | | | | | |     |   | | | | | |   | | 
   | |   |         +---|-|-----------|---------|-------------|-------|-----|-|-|-----|---|-----------------------|-------|-|-------|-|-----|---|-----|-----|---|-----|-----|-|-----|---+ | +-|-|-|---+ | 
   | |   |             | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |           | |   |       | | | |   | |   | | | |     |     |   | | | | | | | |     |     |   | | |     | 
   | |   |             | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |           +-----------------------|-------|-|-|---------------|-------|-|-------+ |     |   | | | +-+ | 
   | |   |             | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |             |   |       | | | |   | |   | | | |     |     |   | | | | | | | |   | |     |   | | | | | | 
   | |   |             | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |             |   |       | | | |   | |   | | | |     |     |   | | | | | | | |   | |     |   | | | | | | 
   | |   |             | | |     | | |   |     |     |     | | | |   | |   | | |     |   | |   |             |   |       | | | |   | |   | | | |     |     |   | | | | | | | |   | |     |   | | | | | | 
   | |   |             | | |     | | |   |     |     |     | | | |   +-----|-|-----------|-|---|-------------|---|-------|-----|---|-|---|-----|---------------|-----|-|-|-------|-|-------+ | | | | | | 
   | |   |             | | |     | | |   |     |     |     | | | |     |   | | |     |   | |   |             |   |       | | | |   | |   | | | |     |     |   | | | | | | | |   | |     | | | | | | | | 
   | |   +-------------|-|-|---------|---+     |     |     | | | |     |   | | |     |   | | +-|-----------------|-------+ | | |   | |   | | | |     |     |   | | +---|---------|-----+ | | | | | | | | 
   | |                 | | |     | | |         |     |     | | | |     |   | | |     |   | | | |             |   |         | | |   | |   | | | |     |     |   | |   | | | | |   | |   | | | | | | | | | 
   | |             +---|-|-|---------|---------------------|---|-------|-----|-|-----|---+ +---|-------------|---|-------------------------|-|-|-----------|---|---------|-|-|---|-|---|---+ | | | | | | 
   | |             |   | | |     | | |         |     |     | | | |     |   | | |     |       | |             |   |         | | |   | |   | | | |     |     |   | |   | | | | |   | |   | |   | | | | | | 
   | |             |   | | |     | | |         |     |     | | | |     |   | | |     |       | |         +---|---------------------------------------|---------|-|---|-|---|-----|-----------|-|-----+ | 
   | |             |   | | |     | | |         |     |     | | | |     |   | | |     |       | |         |   |   |         | | |   | |   | | | |     |     |   | |   | | | | |   | |   | |   | | | |   | 
   | |             |   +-|-|-----|-|-----------|-------------|-|-|---------|---|-----|-------|-----------|---|-------------+ | |   | |   | | | |     |     |   | +-----|-|---+   | | +-|-|-+ | | | |   | 
   | |             |     | |     | | |         |     |     | | | |     |   | | |     |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | | |     | | | | | | | | | |   | 
   | |             |     | |     | | |         |     |     | | | |     |   | | |     |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | | |     | | | | | | | | | |   | 
   | |             |     | |     | | |         |     |     | | | |     |   | | |     |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | | |     | | | | | | | | | |   | 
   | |           +-------|-|-------|-------------------------|---------|---|---------------------------------|---------------------|-|---|-|---|-----|-----|-------------|-|-----|-|-|---|---+ | | |   | 
   | |           | |     | |     | | |         |     |     | | | |     |   | | |     |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | | |     | | | | | |   | | |   | 
   | |           | |     | |     | | |         |     |     | | | |     |   | | |   +---------------------|---|-----------------|---------|-|---|---------------|---------|-------|---|---|-----------+ | 
   | |           P |     | |     | | |         |     |     | | | |     |   | | |   | |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | | |     | | | | | |   | | | | | 
   | |           | |     | |     | | | +-------------|-----|---|-|-----+   | | |   | |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | | +-----|-|-|-|---|---|---+ | | 
   | |           | |     | |     | | | |       |     |     | | | |         | | |   | |       | |         |   |   |           | |   | |   | | | |     |     |   |     | | |       | | | | | |   | |   | | 
   | |           | |     | |     | | | | +-----|-----|-------|---|-----------------|-------------------------|---------------|-|---|-------|---|-----|---------|-+   | | | +-----|-|-|---|---------+ | | 
   | |           | |     | |     | | | | |     |     |     | | | |         | | |   | |       | |         |   |   |           | |   | |   | | | |     |     |   | |   | | | |     | | | | | |   | | | | | 
   | |           | |     | |     | | | | |     |     |     | | | |         | | |   | |       | |         |   |   |           | |   | |   | | | |     |     |   | |   | | | |     | | +-|-|-----|---+ | | 
   | |           | |     | |     | | | | |     |     |     | | | |         | | |   | |       | |         |   |   |           | |   | |   | | | |     |     |   | |   | | | |     | |   | | |   | |   | | 
   | |           | |     | +---------|---+     | +---|-----|---|-|-------------|-----|-------|-|---------|---+   |       +-----|-----|-----|-|-|-------------+ | +---------|-------|---|-|-|-----|-+ | | 
   | |           | |     |       | | | |       | |   |     | | | |         | | |   | |       | |         |       |       |   | |   | |   | | | |     |     | | |     | | | |     | |   | | |   | | | | | 
   | |           | |     |       | | | |       +-+   |     | | | | +---------|-----|-|-------|-|-----+   |       |       |   | |   | |   | | | |     |     | | |     | | | |     | |   | | |   | | | | | 
   | |           | |     |       | | | |             |     | | | | |       | | |   | |       | |     |   |       |       |   | |   | |   | | | |     |     | | |     | | | |     | |   | | |   | | | | | 
   | |           | |     |       | | | |             |     | | | | |       | | |   | |       | |     +-----------|-----------|-----|-----|---|-|-----|---------|-----|-|-|-------|-|-+ | | |   | | | | | 
   | |           | |     |       | | | |             |     | | | | |       | | |   | |       | |         |       |       |   | |   | |   | | | |     |     | | |     | | | |     | | | | | |   | | | | | 
   | |           | |     |       | | | |             |     | | | | |       | | |   | |       | |         | +-------------------|-----|---|-|-|-------------|-----------|---|-----|---+ | | |   | | | | | 
   | |           | |     |       | | | |             |     | | | | |       | | |   | |       | |         | |     |       |   | |   | |   | | | |     |     | | |     | | | |     | |   | | |   | | | | | 
   +-|-------------------|---------|-|---------------|-----|-|-----|-------|-|-|-----+       | |         | |     |       |   | |   | |   | | | |     |     | | |     | | | |     | |   | | |   | | | | | 
     |           | |     |       | | | |             |     | | | | |       | | |   |         | |         | |     |       |   | |   | |   | | | |     |     | | |     | | | |     | |   | | |   | | | | | 
     |           | |     |       | | | |             |     | | | | |       | | |   |     +-----|------H------+   |       |   | |   | |   | | | |   +-|-----|---|-+   | | | +-+   | |   | | |   | | | | | 
     |           | |     |       | | | |             |     | | | | |       | | |   |     |   | |         | | |   |       |   | |   | |   | | | |   | |     | | | |   | | |   |   | |   | | |   | | | | | 
     |           | |     |       | | | |             |     | | | | |       | | |   |     |   | |         | | |   |       |   | |   | |   | | | |   | |     +-----|---|---------+ | |   +-|-+   | | | | | 
     |           | |     |       | | | |             |     | | | | |       | | |   |     |   | |         | | |   |       |   | |   | |   | | | |   | |       | | |   | | |   | | | |     |     | | | | | 
     |       +-----|-----|---------+ | |             |     | | | | |       | | |   |     |   | |         | | |   | +---------------|-----|-|---|-------------|---|-----|-|-----|-----------------+ | | | 
     |       |   | |     |       |   | |             |     | | | | |       | | |   |     |   | |         | | |   | |     |   | |   | |   | | | |   | |       | | |   | | |   | | | |     |     |   | | | 
     |       |   | |     |       |   | |             |     | | | | |       | | |   |     |   | |         | | |   | |     |   | |   | |   | | | |   | |       | | |   | | |   | | | |     |     |   | | | 
     |       |   | |     |       |   | V             |     | | | | |       | | |   |     |   | |         | | |   | |     |   | |   | |   | | | |   | |       | | |   | | |   | | | |     |     |   | | | 
   +-|-------------|-------+     |   | |             |     | | | | |       | | |   |     |   | |         | | |   | +---------------|-------|-+ |   | |       | | |   | | |   | | | |     |     |   | | | 
   | |       |   | |     | |     |   | |             |     | | | | |       | | |   |     |   | |         | | |   |       |   | |   | |   | |   |   | |       | | |   | | |   | | | |     |     |   | | | 
   | |       |   | |     | |     |   | |             |     | | | | |       | | |   |     | +-------------+ | |   |       |   | |   | |   | |   |   | |       | | |   | | |   | | | |     |     |   | | | 
   | |       |   | |     | |     |   | |             |     | | | | |       | | |   |     | | | |           | |   |       |   | |   | |   | |   |   | |       | | |   | | |   | | | |     |     |   | | | 
 +-+ |       |   | |     | |     |   | +-------------|-------|---|-------+ | | |   |   +---|-|-|-----------|-|-------+   |   | |   | |   | |   |   | |       | | |   | | |   | | | |     |     |   | | | 
 |   |       |   | |     | |     |   |               |     | | | | |     | | | |   |   | | | | |           | |   |   |   |   | |   | |   | |   |   | |       | | |   | | |   | | | |     |     |   | | | 
 |   |     +-----|-|-------------|---|---------------|-------|---|-------|---|-----|---|---------------------|---|---|-------------------|-----|---|-|-------|-------|-------|-+ | |     |     |   | | | 
 |   |     | |   | |     | |     |   |               |     | | | | |     | | | |   |   | | | | |           | |   |   |   |   | |   | |   | |   |   | |       | | |   | | |   |   | |     |     |   | | | 
 |   |     | |   | |     | | +---|-------------------|---------+ | |     | | | |   |   +---+ | |         +-|-+   |   |   |   | |   | |   | |   |   | |   +---|---------|-|-----+ | |   +---------+ | | | 
 |   |     | |   | |     | | |   |   |               |     | |   | |     | | | |   |     |   | |         | |     |   |   |   | |   | |   | |   |   | |   |   | | |   | | |   | | | |   | |     | | | | | 
 |   |     | |   | | +-------|-------------------+   +---------+ | | +-----|---|---|-+   |   | |         | |     |   |   |   | | +---------|---|---------|---|-+ |   | | |   | | | +-+ | |     | | | | | 
 |   |     | |   | | |   | | |   |   |           |         | | | | | |   | | | |   | |   |   | |         | |     |   |   |   | | | | |   | |   |   | |   |   |   |   | | |   | | |   | | |     | | | | | 
 |   |     | |   | +-|-------|---|---+           +---------|-------------|-|-|-|-----|---|---|-|---------+ +-----|-----------------------------------|-----------|---|---|---|-|-------|-+     | | | | | 
 |   |     | |   |   |   | | |   |                         | | | | | |   | | | |   | |   |   | |                 |   |   |   | | | | |   | |   |   | |   |   T   |   | | |   | | |   | |       | | | | | 
 +---|-----|-|-------|-------|---------------------------------|---|---------|-|-----|---|-----------------------|---------------|-|-----|---+ |   | |   |   |   |   | | |   | | +-+ | |   +-+ | | | | | 
     |     | |   |   |   | | |   |                         | | | | | |   | | | |   | |   |   | |                 |   |   |   | | | | |   | | | |   | |   |   |   |   | | |   | |   | | |   | | | | | | | 
     |     | |   |   |   | | |   |                         +-----|-|-|-----|---|---------|---|-----------------------|-------|-|-----------|-|-|----------E------|-------|---|---+ | | |   | | | | | | | 
     |     | |   |   |   | | |   |                           | | | | |   | | | |   | |   |   | |                 |   |   |   | | | | |   | | | |   | |   |   |   |   | | |   | | | | | |   | | | | | | | 
     |     | +-------|-----------|---------------------------|-|-|---|---|-----------|---|-----+                 |   |   |   | | | | |   | | | |   | +---|-----------|---------|---+ | |   | | | | | | | 
     |     |     |   |   | | |   |                           | | | | |   | | | |   | |   |   |                   |   |   |   | | | | |   | | | |   |     |   |   |   | | |   | | |   | |   | | | | | | | 
     |     |     |   |   +-|-|-------------------------------|-|-|-------|-|---|---------|---------------+       |   +---------------|---|---------|---------------------|---+ | |   | | +-+ | | | | | | 
     |     |     |   |     | |   |                           | | | | |   | | | |   | |   |   |           |       |       |   | | | | |   | | | |   |     |   |   |   | | |     | |   | | |   | | | | | | 
     |     |     |   |     | | +---------------------------------|-|-|---|---|-|---|-|-------|-----------|-------|-----------|---|-------------|---|-----|---|---|-----|-|-------|---+ | +-+ | | | | | | 
     |     |     |   |     | | | |                           | | | | |   | | | |   | |   |   |           |       |       |   | | | | |   | | | |   |     |   |   |   | | |     | |     |   | | | | | | | 
     +-----+ +-----+ |     | | | |                           | | | | |   | | | |   | |   |   |       +---|-+     |       |   | | | | +-----|-------|---------|-----------|-----+ |     +---|-+ | | | | | 
             |   | | |     | | | |                           | | | | |   | | | |   | |   |   |       |   | |     |       |   | | | |     | | | |   |     |   |   |   | | |       |         |   | | | | | 
 +---------------------------|---+                           | | | | |   | | | |   | +-------|-------|-----------|-------|---|-----------|-|---------------------|-----|-|---+   | +-------|-+ | | | | | 
 |           |   | | |     | | |                             | | | | |   | | | |   |     |   |       |   | |     |       |   | | | |     | | | |   |     |   |   |   | | |   |   | |       | | | | | | | 
 |           |   | | |     | | |                             | | | | |   | | | |   | +---|-----------|---|-|-----|-------|---|-|-----+   | | +-|---------|---|---------|-|---|-+ | |       +-+ | | | | | 
 |           |   | | |     | | |                             | | | | |   | | | |   | |   |   |       |   | |     |       |   | | | | |   | |   |   |     |   |   |   | | |   | | | |           | | | | | 
 +-----------|-----|-------|---|---------------------------------|-------|---|-------|---------------|-----------|---+   |   | | | | |   | |   |   +-----|-+ |   |   | | |   | | | |           | | | | | 
             |   | | |     | | |                             | | | | |   | | | |   | |   |   |       |   | |     |   |   |   | | | | |   | |   |         | | |   |   | | |   | | | |           | | | | | 
 +---------------|-|-|---------|-----------------------------|-----|-|-------|-|---|-|---|---|-------|---------------|-------|---|-|-|---------|---+     | | |   |   | | |   | | | |           | | | | | 
 |           |   | | |     | | |                             | | | | |   | | | |   | |   |   |       |   | |     |   |   |   | | | | |   | |   |   |     | | |   |   | | |   | | | |           | | | | | 
 |           |   | | |   +-|---|-+ +-------------------------------+ |   | | | |   +-----|---|-------|---------------|-------|-------|---+ |   |   | +-----|-|---|-----------|-|---------------|---+ | | 
 |           |   | | |   | | | | | |                         | | |   |   | | | |     |   |   |       |   | |     |   |   |   | | | | |     |   |   | |   | | |   |   | | |   | | | |           | |   | | 
 +-----------|-----|-|---|-|---|-|---+                       | | |   |   | | | |     |   |   |       |   | |     +---|---|---|-|-|-+ |     |   |   | | +---|---------|-|-----|-|---|---+ +-----|---+ | | 
             |   | | |   | | | | | | |                       | | |   |   | | | |     |   |   |       |   | |         |   |   | | |   |     |   |   | | | | | |   |   | | |   | | | |   | |     | | | | | 
             |   | | |   | | | | | | |       +---------------|---|-------|---|-|-----|---|-----------|---|-|---------|-------|-|-|---+     |   |   +---+ | | |   | +-+ | +---|-------------+   | | | | | 
             |   | | |   | | | | | | |       |               | | |   |   | | | |     |   |   |       |   | |         |   |   | | |         |   |     |   | | |   | |   |     | | | |   | | |   | | | | | 
             |   | | |   | | | | | | |       |               | | |   |   | | | |     |   |   |       |   | +-------+ +-------|-----------------------------|---+ +-|-----------|-------+ | |   | | | | | 
             |   | | |   | | | | | | |       |               | | |   |   | | | |     |   |   |       |   |         |     |   | | |         |   |     |   | | | |   |   |     | | | |     | |   | | | | | 
 +---+       |   | +-----|---------|---------|---------------|-------|-----|-+ |     |   |   |       |   +---------|-----|-------|-------------|---------|-|-----------|-----|---+ |   +-|-+   | | | | | 
 |   |       |   |   |   | | | | | | |       |               | | |   |   | |   |     |   |   |       |             |     |   | | |         |   |     |   | | | |   |   |     | |   |   | |     | | | | | 
 +---|-----+ |   |   |   | | | | | | |       |               | | |   |   +-|---|-----|---|-----------|-------+     +-----|---|-----------------|-----|-------|-|---------------|-------|---+   | | | | | 
     |     | |   |   |   | | | | | | |       |               | | |   |     |   |     |   |   |       |       |           |   | | |         |   |     |   | | | |   |   |     | |   |   | | |   | | | | | 
     |     | |   |   +---|---|-|-----|---+   |               | | |   |     +---------|---|-------------------------------------|-|-------------------------|-|---+ |   |     | | +-------|-|-------+ | | 
     |     | |   |       | | | | | | |   |   |               | | |   |         |     |   |   |       |       |           |   | | |         |   |     |   | | | | | |   |     | | | |   | | |   | |   | | 
     |     | |   |       | | | | | | |   |   |               | | |   |         |   +---------|---------------|-----------|---|-------------|---------------|-----|-----------|---------+ | +-+ | |   | | 
     |     | |   |       | | | | | | |   |   |               | | |   |         |   | |   |   |       |       |           |   | | |         |   |     |   | | | | | |   |     | | | |     |   | | |   | | 
     +-----|-----|---------+ | | | | +---+   |               | | +-----------------------|-----------------+ |           |   | | |         |   |     |   | | | | | +---------|---+ +-----|-+ | | |   | | 
           | |   |       |   | | | |         |               | |     |         |   | |   |   |       |     | |           |   | | |         |   |     |   | | | | |     |     | |         | | | | |   | | 
           | +---|-------|---|-+ | | +-------|---------------|-----------------------|---|---|-------------|-|-----------+   | | |         | +-------|---|-|-+ | | +---|-----|-----------|---|---+   | | 
           |     |       |   |   | | |       |               | |     |         |   | |   |   |       |     | |               | | |         | | |     |   | |   | | |   |     | |         | | | |     | | 
           |     |       |   |   | | |       |               | |     |         |   | |   |   |     +-|-----------------------+ | +-----------|---------------+ | | | +-|-----|-|-------+ | | | |     | | 
           |     |       |   |   | | |       |               | |     |         |   | |   |   |     | |     | |                 |           | | |     |   | | | | | | | |     | |       | | | | |     | | 
           +-----|-----------|-------|-------|---------------|-------|-------------+ |   +---+     +-|-----|-------------------|-------------|-|-----|---+ +-+ | | | | |     | | +---+ +-+ | | +---+ | | 
                 |       |   |   | | |       |               | |     |         |     |               |     | |                 |           | | |     |         | | | | |     | | |   |     | |     | | | 
                 |       |   +---+ | |       |               | |     |         |     +---------------|-----|-----------------------------------------|---------+ | | | +-------|-----------+ |     | | | 
                 |       |         | |       |               | |     |         |                     |     | |                 |           | | |     |           | | |       | | |   |       |     | | | 
                 |       +-----------|-------|---------------|-|-----|-------------------------------------|-------------------|-----------+ | +-----+ +-----------------------+ |   |       |     | | | 
                 |                 | |       |               | |     |         |                     |     | |                 |             |         |         | | |       |   |   |       |     | | | 
                 |                 +---------------------------|-----|-------------------------------|-------|-----------------|-------------+         +-------------|-------------+ +-------|---+ | | | 
                 |                   |       |               | |     |         |                     |     | |                 |                                 | | |       |   | |         |   | | | | 
                 +-------------------|-----------------------|-|-----|---------------------------------------------+ +---------|---------------------------+     | | |       +---|-+         |   | | | | 
                                     |       |               | |     |         |                     |     | |     | |         |                           |     | | |           |           |   | | | | 
                                     +-------+               +-+     +---------+                     +-------------+ +---------|---------------------------|-----|---------------|-----------+   +---|-+ 
                                                                                                           | |                 |                           |     | | |           |                 | |   
                                                                     +-------------------------------------+ +-----------------+                           +-----|-------------------------------+ | |   
                                                                     |                                                                                           | | |           |               | | |   
                                                                     +-------------------------------------------------------------------------------------------+ +-+           +---------------+ +-+   
                                                                                                                                                                                                         """
